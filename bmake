#!/bin/sh

sharedir="`dirname $0`/share"

usage()
{
	if [ "$#" -eq 0 ] ; then
		fd=1
	else
		fd=$1
	fi

	cat <<EOF >&$fd
bmake command [options]

Possible commands are:
  install
  update
  source add
  source remove
  source list
EOF
}

copyfile()
{
	echo "# Generated by BetterMake" > "$1"
	echo "# md5sum: "`md5sum "$sharedir/$1" | head -c32` >> "$1"
	echo >> "$1"
	cat "$sharedir/$1" >> "$1"

	test ! -z "$2" && chmod "$2" "$1"
}

if [ "$#" -eq 0 ] ; then
	usage
	exit
fi

cmd=$1; shift;

case "$cmd" in
	install)
		for file in "Makefile.in" "configure"
		do
			test -e "$file" || continue

			echo "$file already exists, cowardly giving up" >&2
			exit 1
		done

		copyfile "Makefile.in"
		copyfile "configure" 0755

		;;
	
	help | -? | --help)
		usage
		;;

	*)
		usage 2
		exit 1
		;;
esac
